# Chat API backend

## How to execute server

Run the following commands:

install missed dependencies:
```sh  
yarn
```  

then
run command for public start (by default runs on http://localhost:5000/ ):
```sh
yarn build
yarn start
```  

or for develop mode using nodemon:
```sh  
yarn dev
```

for autogenerated types of sheema.graphql run command:
```
yarn codegen
```

## Explaining file dependencies

- "codegen.ts" - settings for for autogenerated types of sheema.graphql
- "__generated__" - folder generated automatically with file "resolvers-types.ts"

- "fixtures.json" - mocked data instead of database
- ".prettierrc.js" - code style rules

- "main.js" - start server file
- "types/dataSourceContext.ts" -  context type for mocked database usage (used in "codegen.ts")

## GraphQL schema

Main objects:
```
//all fields required insted of 'photoUrl', which can be skipped by user
type User {  
    id: String!  
    name: String!  
    forumsIds: [String!]!  
    photoUrl: String  
}  

//Forum have information about all User for easyer geting lsit and infoo about them
type Forum {  
    id: String!  
    name: String!  
    ownerId: String!  
    usersIds: [String!]!  
    users: [User!]!  
    messagesIds: [String!]!  
}  

//Message have information about owner (User) for easyer geting info about 'photo' and 'name' 
type Message {  
    id: String!  
    text: String!  
    ownerId: String!  
    owner: User!  
    forumId: String!  
    sendingTime: String!  
}  
  ```

Queries:
```
//'getAllUsers', 'getAllForums', 'getAllMessages' just extra
type Query {  
    getAllUsers: [User!]!  
    getAllForums: [Forum!]!  
    getAllMessages: [Message!]!
    
    getJoinedForums(userId: String!): [Forum!]!  
    getAvailableForums(userId: String!): [Forum!]!  
    getForumMessages(forumId: String!): [Message!]!  
}  
  ```

Mutations:
```
type Mutation {  
    createUser(newUser: CreateUserInput!): User!  
    createForum(newForum: CreateForumInput!): Forum!  
    sendMessageInForum(newMessage: SendForumMessageInput!): Message!  
    joinForumById(joinForum: JoinForumInput!): JoinForumResponse!  
}  
  ```

Input types for values in Mutations:
```
input CreateUserInput {  
    name: String!  
    photoUrl: String  
}  
  
input CreateForumInput {  
    ownerId: String!  
    name: String!  
}  
  
input JoinForumInput {  
    userId: String!  
    forumId: String!  
}  
  
input SendForumMessageInput {  
    ownerId: String!  
    text: String!  
    forumId: String!  
}  
```

Response types for values in Mutations:
```
type JoinForumResponse {  
    forum: Forum!  
    user: User!  
}
```

### Apollographql sandbox requests list

```
query Query {
  getAllUsers {
    id
    name
    forumsIds
    photoUrl
  }

  getAllForums {
    id
    name
    ownerId
    usersIds
    messagesIds
  }

  getAllMessages {
    id
    text
    ownerId
    sendingTime
  }
}

  
query Forums {
  getJoinedForums(userId: "u-2") {
    id
    name
    ownerId
    usersIds
    messagesIds
    users {
      id
      name
      forumsIds
      photoUrl
    }
  }
  getAvailableForums(userId: "u-2") {
    id
    name
    ownerId
    usersIds
    messagesIds
    users {
      id
      name
      forumsIds
      photoUrl
    }
  }
}
  

query ForumMessages {
  getForumMessages(forumId: "f-1") {
    id
    ownerId
    text
    forumId
    sendingTime
    owner {
      id
      name
      forumsIds
      photoUrl
    }
  }
}


mutation SendMessageInForum {
  sendMessageInForum(newMessage: {
    ownerId: "u-1",
    text: "Firest message"
    forumId: "f-1"
  }) {
    id
    text
    ownerId
    sendingTime
    forumId
    owner {
      id
      name
      forumsIds
      photoUrl
    }
  }
}

 
mutation CreateForum {
  createForum(newForum: {
    ownerId: "u-3"
    name: "Created Forum"
  }) {
    id
    name
    ownerId
    usersIds
    messagesIds
  }
}

 
mutation JoinForum {
  joinForumById(joinForum: {
    userId: "u-3"
    forumId: "f-1"
  }) {
    forum {
      id
      name
      ownerId
      usersIds
      users {
        id
        name
        forumsIds
        photoUrl
      }
      messagesIds
    }
    user {
      id
      name
      forumsIds
      photoUrl
    }
  }
}


mutation Mutation {
  createUser(newUser: {
    name: "Tom"
    photoUrl: null
  }) {
    id
    name
    forumsIds
    photoUrl
  }
}
```
